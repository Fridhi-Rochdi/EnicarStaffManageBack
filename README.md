# üéì ENICarthage Staff Manager - Backend

<div align="center">

![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.0-brightgreen?style=for-the-badge&logo=spring-boot)
![Java](https://img.shields.io/badge/Java-17-orange?style=for-the-badge&logo=openjdk)
![Maven](https://img.shields.io/badge/Maven-3.8+-red?style=for-the-badge&logo=apache-maven)
![License](https://img.shields.io/badge/License-MIT-blue?style=for-the-badge)

**API REST moderne et s√©curis√©e pour la gestion du personnel de l'ENI Carthage**

[Documentation API](#-api-endpoints) ‚Ä¢ [Installation](#-installation) ‚Ä¢ [Fonctionnalit√©s](#-fonctionnalit√©s)

</div>

---

## üìã Table des mati√®res

- [√Ä propos](#-√†-propos)
- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Technologies](#-technologies)
- [Pr√©requis](#-pr√©requis)
- [Installation](#-installation)
- [Configuration](#-configuration)
- [D√©marrage](#-d√©marrage)
- [API Endpoints](#-api-endpoints)
- [S√©curit√©](#-s√©curit√©)
- [Base de donn√©es](#-base-de-donn√©es)
- [Stockage de fichiers](#-stockage-de-fichiers)

---

## üéØ √Ä propos

Le **ENICarthage Staff Manager Backend** est une API REST d√©velopp√©e avec Spring Boot pour g√©rer les op√©rations administratives de l'√âcole Nationale d'Ing√©nieurs de Carthage. Le syst√®me offre une solution compl√®te pour la gestion des tickets d'impression, des utilisateurs, des r√©servations de salles et des p√©riodes d'examens.

### Objectifs du projet
- ‚úÖ Centraliser la gestion des demandes d'impression
- ‚úÖ Automatiser les processus administratifs
- ‚úÖ S√©curiser les acc√®s avec JWT
- ‚úÖ Fournir une API RESTful document√©e
- ‚úÖ G√©rer les fichiers avec MinIO

---

## ‚ú® Fonctionnalit√©s

### üîê Authentification & Autorisation
- **JWT Authentication** - Tokens s√©curis√©s avec expiration
- **Gestion des r√¥les** - ADMIN, STAFF, PROFESSOR
- **Endpoints prot√©g√©s** - Contr√¥le d'acc√®s bas√© sur les r√¥les
- **Refresh tokens** - Session persistante

### ÔøΩ Gestion des Tickets
- ‚úÖ Cr√©ation de tickets avec upload de fichiers (PDF, images, documents)
- ‚úÖ Suivi de statut (PENDING, IN_PROGRESS, APPROVED, REJECTED, COMPLETED)
- ‚úÖ T√©l√©chargement et visualisation des documents
- ‚úÖ Historique complet des modifications
- ‚úÖ Recherche et filtrage avanc√©s

### üë• Gestion des Utilisateurs
- ‚úÖ CRUD complet des utilisateurs
- ‚úÖ Gestion des r√¥les et permissions
- ‚úÖ Activation/D√©sactivation de comptes
- ‚úÖ Profils utilisateurs d√©taill√©s

### üè¢ R√©servations de Salles
- ‚úÖ R√©servation de salles avec √©quipements
- ‚úÖ Validation par les administrateurs
- ‚úÖ Gestion des conflits de r√©servation
- ‚úÖ Commentaires administratifs

### üìÖ P√©riodes d'Examens
- ‚úÖ Cr√©ation et gestion des p√©riodes
- ‚úÖ Planification des examens
- ‚úÖ Visualisation du calendrier

### üìÅ Stockage de Fichiers
- ‚úÖ Int√©gration MinIO pour stockage S3-compatible
- ‚úÖ Upload de fichiers multi-format
- ‚úÖ T√©l√©chargement s√©curis√© avec authentification
- ‚úÖ Gestion automatique des types MIME

---

## üõ† Technologies

### Backend Core
- **Spring Boot 3.2.0** - Framework principal
- **Spring Security** - Authentification et autorisation
- **Spring Data JPA** - ORM et acc√®s aux donn√©es
- **Hibernate** - Impl√©mentation JPA

### Base de donn√©es
- **H2 Database** - Base de donn√©es embarqu√©e (d√©veloppement)
- **MySQL 8.0+** - Base de donn√©es production
- **Spring Data JPA** - Abstraction d'acc√®s aux donn√©es

### S√©curit√©
- **JWT (JSON Web Tokens)** - Authentification stateless
- **BCrypt** - Hachage des mots de passe
- **CORS** - Configuration cross-origin

### Stockage
- **MinIO** - Stockage d'objets S3-compatible
- **Docker** - Conteneurisation MinIO

### Build & D√©ploiement
- **Maven 3.8+** - Gestion de d√©pendances
- **Java 17** - Runtime
- **Spring Boot DevTools** - Rechargement √† chaud

### Documentation
- **OpenAPI 3.0** - Documentation API
- **Postman Collection** - Tests d'API
- **Swagger UI** - Interface de documentation

---

## üì¶ Pr√©requis

Avant de commencer, assurez-vous d'avoir install√© :

| Logiciel | Version | T√©l√©chargement |
|----------|---------|----------------|
| Java JDK | 17+ | [Oracle](https://www.oracle.com/java/technologies/downloads/) |
| Maven | 3.8+ | [Apache Maven](https://maven.apache.org/download.cgi) |
| Docker | Latest | [Docker Desktop](https://www.docker.com/products/docker-desktop) |
| Git | Latest | [Git SCM](https://git-scm.com/) |

### Optionnel
- **MySQL 8.0+** - Pour la production
- **Postman** - Pour tester l'API

---

## üöÄ Installation

### 1. Cloner le repository

```bash
git clone https://github.com/Fridhi-Rochdi/EnicarStaffManageBack.git
cd EnicarStaffManageBack
```

### 2. D√©marrer MinIO (Stockage de fichiers)

```bash
# Avec Docker Compose
docker-compose up -d

# V√©rifier que MinIO est d√©marr√©
docker ps | grep minio
```

MinIO sera accessible sur :
- **API**: http://localhost:9100
- **Console**: http://localhost:9101
- **Identifiants**: minioadmin / minioadmin

### 3. Installer les d√©pendances

```bash
mvn clean install
```

---

## ‚öôÔ∏è Configuration

### Variables d'environnement

Cr√©ez un fichier `application-local.properties` (optionnel) :

```properties
# JWT Configuration
jwt.secret=VotreClefSecreteSuperLongueEtComplexePourLaProduction
jwt.expiration=86400000

# Database (H2 - D√©veloppement)
spring.datasource.url=jdbc:h2:file:./data/staffmanagerdb
spring.datasource.username=sa
spring.datasource.password=

# MinIO Configuration
minio.url=http://localhost:9100
minio.access-key=minioadmin
minio.secret-key=minioadmin
minio.bucket-name=enicarthage-files

# CORS
cors.allowed-origins=http://localhost:5173,http://localhost:3000

# File Upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
```

### Base de donn√©es MySQL (Production)

Pour utiliser MySQL en production, modifiez `application-mysql.properties` :

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/staffmanagerdb
spring.datasource.username=votre_utilisateur
spring.datasource.password=votre_mot_de_passe
spring.jpa.hibernate.ddl-auto=update
```

Puis d√©marrez avec :
```bash
mvn spring-boot:run -Dspring-boot.run.profiles=mysql
```

---

## üé¨ D√©marrage

### M√©thode 1 : Maven (Recommand√©e)

```bash
# D√©veloppement avec rechargement automatique
mvn spring-boot:run
```

### M√©thode 2 : Script Windows

```bash
# D√©marrer tout (MinIO + Backend)
.\start.bat
```

### M√©thode 3 : JAR ex√©cutable

```bash
# Compiler
mvn clean package

# Ex√©cuter
java -jar target/staff-manager-0.0.1-SNAPSHOT.jar
```

### V√©rification

L'application sera accessible sur : **http://localhost:8081**

Testez avec :
```bash
curl http://localhost:8081/api/test
```

R√©ponse attendue :
```json
{
  "success": true,
  "message": "API is working!"
}
```

---

## üì° API Endpoints

### üîê Authentication

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/auth/login` | Connexion utilisateur | ‚ùå |
| POST | `/api/auth/register` | Inscription | ‚ùå |

**Exemple Login:**
```bash
curl -X POST http://localhost:8081/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@enicarthage.tn",
    "password": "admin123"
  }'
```

### üìÑ Tickets

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/tickets` | Liste des tickets | ‚úÖ ADMIN/STAFF |
| POST | `/api/tickets` | Cr√©er un ticket | ‚úÖ |
| GET | `/api/tickets/{id}` | D√©tails d'un ticket | ‚úÖ |
| PUT | `/api/tickets/{id}` | Modifier un ticket | ‚úÖ |
| DELETE | `/api/tickets/{id}` | Supprimer un ticket | ‚úÖ |
| GET | `/api/tickets/{id}/download` | T√©l√©charger le fichier | ‚úÖ |
| PATCH | `/api/tickets/{id}/status` | Changer le statut | ‚úÖ ADMIN/STAFF |
| GET | `/api/tickets/my-tickets` | Mes tickets | ‚úÖ |

**Exemple Upload de fichier:**
```bash
curl -X POST http://localhost:8081/api/tickets \
  -H "Authorization: Bearer {token}" \
  -F "ticket={\"title\":\"Impression TP\",\"description\":\"TP Java\",\"totalNumber\":30}" \
  -F "file=@document.pdf"
```

### üë• Users

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/users` | Liste des utilisateurs | ‚úÖ ADMIN |
| POST | `/api/users` | Cr√©er un utilisateur | ‚úÖ ADMIN |
| GET | `/api/users/{id}` | D√©tails utilisateur | ‚úÖ ADMIN |
| PUT | `/api/users/{id}` | Modifier utilisateur | ‚úÖ ADMIN |
| DELETE | `/api/users/{id}` | Supprimer utilisateur | ‚úÖ ADMIN |
| GET | `/api/users/me` | Mon profil | ‚úÖ |

### üè¢ Room Reservations

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/room-reservations` | Liste des r√©servations | ‚úÖ ADMIN/STAFF |
| POST | `/api/room-reservations` | Cr√©er r√©servation | ‚úÖ |
| GET | `/api/room-reservations/{id}` | D√©tails r√©servation | ‚úÖ |
| PUT | `/api/room-reservations/{id}` | Modifier r√©servation | ‚úÖ |
| DELETE | `/api/room-reservations/{id}` | Annuler r√©servation | ‚úÖ |
| PATCH | `/api/room-reservations/{id}/status` | Changer statut | ‚úÖ ADMIN/STAFF |
| GET | `/api/room-reservations/my-reservations` | Mes r√©servations | ‚úÖ |

### üìÖ Exam Periods

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| GET | `/api/exam-periods` | Liste des p√©riodes | ‚úÖ |
| POST | `/api/exam-periods` | Cr√©er p√©riode | ‚úÖ ADMIN/STAFF |
| GET | `/api/exam-periods/{id}` | D√©tails p√©riode | ‚úÖ |
| PUT | `/api/exam-periods/{id}` | Modifier p√©riode | ‚úÖ ADMIN/STAFF |
| DELETE | `/api/exam-periods/{id}` | Supprimer p√©riode | ‚úÖ ADMIN/STAFF |
| GET | `/api/exam-periods/active` | P√©riodes actives | ‚úÖ |

---

## üîí S√©curit√©

### JWT Authentication

Tous les endpoints prot√©g√©s n√©cessitent un token JWT dans le header :

```bash
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### R√¥les disponibles

| R√¥le | Description | Permissions |
|------|-------------|-------------|
| **ADMIN** | Administrateur | Acc√®s complet √† toutes les fonctionnalit√©s |
| **STAFF** | Personnel administratif | Gestion des tickets, r√©servations, p√©riodes d'examens |
| **PROFESSOR** | Professeur | Cr√©ation de tickets et r√©servations |

### Utilisateurs par d√©faut

| Email | Mot de passe | R√¥le |
|-------|--------------|------|
| admin@enicarthage.tn | admin123 | ADMIN |
| staff@enicarthage.tn | staff123 | STAFF |
| prof.dupont@enicarthage.tn | prof123 | PROFESSOR |

‚ö†Ô∏è **Important**: Changez ces mots de passe en production !

---

## üíæ Base de donn√©es

### Sch√©ma de base de donn√©es

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Users    ‚îÇ       ‚îÇ   Tickets    ‚îÇ       ‚îÇ  RoomReservations   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id          ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ owner_id     ‚îÇ       ‚îÇ id                  ‚îÇ
‚îÇ email       ‚îÇ       ‚îÇ title        ‚îÇ       ‚îÇ user_id            ‚îÇ‚óÑ‚îÄ‚îÄ‚îê
‚îÇ password    ‚îÇ       ‚îÇ description  ‚îÇ       ‚îÇ room_name           ‚îÇ   ‚îÇ
‚îÇ first_name  ‚îÇ       ‚îÇ file_name    ‚îÇ       ‚îÇ reservation_date    ‚îÇ   ‚îÇ
‚îÇ last_name   ‚îÇ       ‚îÇ file_path    ‚îÇ       ‚îÇ start_time          ‚îÇ   ‚îÇ
‚îÇ role        ‚îÇ       ‚îÇ status       ‚îÇ       ‚îÇ end_time            ‚îÇ   ‚îÇ
‚îÇ active      ‚îÇ       ‚îÇ total_number ‚îÇ       ‚îÇ status              ‚îÇ   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
                                                                        ‚îÇ
                                             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
                                             ‚îÇ ExamPeriods  ‚îÇ           ‚îÇ
                                             ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§           ‚îÇ
                                             ‚îÇ id           ‚îÇ           ‚îÇ
                                             ‚îÇ name         ‚îÇ           ‚îÇ
                                             ‚îÇ start_date   ‚îÇ           ‚îÇ
                                             ‚îÇ end_date     ‚îÇ           ‚îÇ
                                             ‚îÇ is_active    ‚îÇ           ‚îÇ
                                             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Console H2

Acc√©dez √† la console H2 pour le d√©veloppement :
- **URL**: http://localhost:8081/h2-console
- **JDBC URL**: `jdbc:h2:file:./data/staffmanagerdb`
- **Username**: `sa`
- **Password**: (vide)

---

## üìÅ Stockage de fichiers

### MinIO Configuration

Le syst√®me utilise MinIO pour le stockage de fichiers (S3-compatible).

**Console MinIO**: http://localhost:9101
- Username: `minioadmin`
- Password: `minioadmin`

### Bucket structure

```
enicarthage-files/
‚îú‚îÄ‚îÄ tickets/
‚îÇ   ‚îú‚îÄ‚îÄ 2025/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 01/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ document1.pdf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ image.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 02/
‚îÇ   ‚îî‚îÄ‚îÄ ...
```

### Types de fichiers support√©s

- **Documents**: PDF, DOC, DOCX, TXT
- **Images**: PNG, JPG, JPEG, GIF
- **Autres**: ZIP, RAR

**Taille maximale**: 10 MB par fichier

---

## üß™ Tests

### Postman Collection

Une collection Postman compl√®te est disponible dans `/postman/`.

**Import dans Postman:**
1. Ouvrir Postman
2. File ‚Üí Import
3. S√©lectionner `ENICarthage_Staff_Manager.postman_collection.json`

### Tests unitaires

```bash
# Ex√©cuter tous les tests
mvn test

# Tests avec couverture
mvn clean test jacoco:report
```

---

## üìö Documentation API

### OpenAPI/Swagger

Documentation interactive disponible dans `openapi.json`.

Pour visualiser :
1. Aller sur [Swagger Editor](https://editor.swagger.io/)
2. Importer le fichier `openapi.json`

### Exemples de requ√™tes

Voir le dossier `/frontend-integration/` pour des exemples React.

---

## üê≥ Docker

### Docker Compose (MinIO uniquement)

```bash
# D√©marrer MinIO
docker-compose up -d

# Arr√™ter
docker-compose down

# Voir les logs
docker-compose logs -f minio
```

### Dockeriser l'application (optionnel)

```dockerfile
FROM openjdk:17-slim
WORKDIR /app
COPY target/*.jar app.jar
EXPOSE 8081
ENTRYPOINT ["java", "-jar", "app.jar"]
```

```bash
# Build
docker build -t enicar-backend .

# Run
docker run -p 8081:8081 enicar-backend
```

---

## üöÄ D√©ploiement en production

### Checklist avant d√©ploiement

- [ ] Changer le `jwt.secret` dans `application.properties`
- [ ] Configurer MySQL au lieu de H2
- [ ] Changer les mots de passe par d√©faut
- [ ] Configurer HTTPS
- [ ] Configurer MinIO en production
- [ ] Activer les logs de production
- [ ] Configurer CORS correctement
- [ ] Backup automatique de la base de donn√©es

### Variables d'environnement recommand√©es

```bash
export JWT_SECRET=votre-secret-super-long-et-complexe
export DB_URL=jdbc:mysql://prod-db:3306/staffmanagerdb
export DB_USERNAME=prod_user
export DB_PASSWORD=prod_password
export MINIO_URL=https://minio.votre-domaine.com
export MINIO_ACCESS_KEY=votre_access_key
export MINIO_SECRET_KEY=votre_secret_key
```

---

## üìÇ Structure du projet

```
enicarthageStaffManagerBackend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/tn/enicarthage/staffmanager/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configurations (Security, CORS, MinIO)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/          # REST Controllers
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exception/           # Exception handlers
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/               # Entit√©s JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/          # Repositories Spring Data
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security/            # JWT & Security
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service/             # Business logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.properties
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application-mysql.properties
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ application-prod.properties
‚îÇ   ‚îî‚îÄ‚îÄ test/                        # Tests unitaires
‚îú‚îÄ‚îÄ data/                            # Base de donn√©es H2
‚îú‚îÄ‚îÄ frontend-integration/            # Exemples React
‚îú‚îÄ‚îÄ postman/                         # Collection Postman
‚îú‚îÄ‚îÄ docker-compose.yml               # Configuration Docker
‚îú‚îÄ‚îÄ pom.xml                          # D√©pendances Maven
‚îî‚îÄ‚îÄ README.md
```

---

## ü§ù Contribution

Les contributions sont les bienvenues ! Voici comment contribuer :

1. **Fork** le projet
2. **Cr√©er** une branche (`git checkout -b feature/AmazingFeature`)
3. **Commit** vos changements (`git commit -m 'Add AmazingFeature'`)
4. **Push** vers la branche (`git push origin feature/AmazingFeature`)
5. **Ouvrir** une Pull Request

---

## üìù License

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

---

## üë®‚Äçüíª Auteur

**Rochdi Fridhi**
- GitHub: [@Fridhi-Rochdi](https://github.com/Fridhi-Rochdi)
- Email: rochdi.fridhi@enicarthage.tn

---

## üôè Remerciements

- ENI Carthage pour le support du projet
- Spring Boot Community
- MinIO Team

---

<div align="center">

**‚≠ê Si ce projet vous a aid√©, n'oubliez pas de laisser une √©toile ! ‚≠ê**

Made with ‚ù§Ô∏è by ENI Carthage Students

</div>

L'application sera accessible sur : **http://localhost:8080**

## üë• Utilisateurs par D√©faut

Le syst√®me cr√©e automatiquement trois utilisateurs au d√©marrage :

| R√¥le       | Email                      | Mot de passe |
|------------|----------------------------|--------------|
| Admin      | admin@enicarthage.tn       | admin123     |
| Professeur | prof.dupont@enicarthage.tn | prof123      |
| Staff      | staff@enicarthage.tn       | staff123     |

## üì° API Endpoints

### Authentication

#### Login
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "prof.dupont@enicarthage.tn",
  "password": "prof123"
}
```

**R√©ponse :**
```json
{
  "success": true,
  "message": "Login successful",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "type": "Bearer",
    "id": 1,
    "email": "prof.dupont@enicarthage.tn",
    "firstName": "Jean",
    "lastName": "Dupont",
    "role": "PROFESSOR"
  }
}
```

#### Register
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "new.user@enicarthage.tn",
  "password": "password123",
  "firstName": "John",
  "lastName": "Doe",
  "role": "PROFESSOR"
}
```

#### Get Current User
```http
GET /api/auth/me
Authorization: Bearer {token}
```

### Tickets

#### Cr√©er un Ticket
```http
POST /api/tickets
Authorization: Bearer {token}
Content-Type: multipart/form-data

ticket: {
  "title": "Math√©matiques - Alg√®bre Lin√©aire",
  "description": "Notes de cours",
  "fileType": "COURS",
  "totalNumber": 25
}
file: [fichier PDF/DOC]
```

#### Obtenir tous les Tickets (Admin/Staff uniquement)
```http
GET /api/tickets
Authorization: Bearer {token}
```

#### Obtenir mes Tickets
```http
GET /api/tickets/my-tickets
Authorization: Bearer {token}
```

#### Obtenir un Ticket par ID
```http
GET /api/tickets/{id}
Authorization: Bearer {token}
```

#### Mettre √† jour un Ticket
```http
PUT /api/tickets/{id}
Authorization: Bearer {token}
Content-Type: multipart/form-data

ticket: {
  "title": "Titre mis √† jour",
  "description": "Description",
  "fileType": "EXAMEN",
  "totalNumber": 30
}
file: [nouveau fichier optionnel]
```

#### Mettre √† jour le Statut (Admin/Staff uniquement)
```http
PATCH /api/tickets/{id}/status?status=EN_COURS
Authorization: Bearer {token}
```

#### Supprimer un Ticket
```http
DELETE /api/tickets/{id}
Authorization: Bearer {token}
```

### Test

#### Health Check
```http
GET /api/test/health
```

#### Public Endpoint
```http
GET /api/test/public
```

## üìä Types de Fichiers

- `COURS` - Cours
- `TRAVEAUX_DIRIGES` - Travaux Dirig√©s
- `TRAVEAUX_PRATIQUES` - Travaux Pratiques
- `COURS_INTEGRE` - Cours Int√©gr√©
- `EXAMEN` - Examen
- `EXAMEN_INTELLIGENT` - Examen Intelligent

## üìà Statuts des Tickets

- `EN_ATTENTE` - En Attente
- `EN_COURS` - En Cours
- `TERMINE` - Termin√©
- `ANNULE` - Annul√©

## üîê S√©curit√©

- Authentification JWT
- Tokens valides pendant 24 heures
- Mots de passe hash√©s avec BCrypt
- CORS configur√© pour le frontend
- Protection CSRF d√©sactiv√©e (API REST)

## üìÅ Structure du Projet

```
src/main/java/tn/enicarthage/staffmanager/
‚îú‚îÄ‚îÄ config/              # Configuration (Security, CORS, etc.)
‚îú‚îÄ‚îÄ controller/          # REST Controllers
‚îú‚îÄ‚îÄ dto/                 # Data Transfer Objects
‚îú‚îÄ‚îÄ exception/           # Exception Handlers
‚îú‚îÄ‚îÄ model/               # Entit√©s JPA
‚îú‚îÄ‚îÄ repository/          # Repositories JPA
‚îú‚îÄ‚îÄ security/            # JWT & Security Classes
‚îî‚îÄ‚îÄ service/             # Business Logic
```

## üóÑÔ∏è Console H2 (Mode D√©veloppement)

Acc√©der √† la console H2 : **http://localhost:8080/h2-console**

- **JDBC URL:** `jdbc:h2:mem:staffmanagerdb`
- **Username:** `sa`
- **Password:** *(vide)*

## üì¶ Upload de Fichiers

Les fichiers upload√©s sont stock√©s dans le dossier `./uploads` √† la racine du projet.

Taille maximale : **10 MB**

## üß™ Tests

```bash
# Ex√©cuter les tests
mvn test

# Ex√©cuter avec couverture
mvn test jacoco:report
```

## üîÑ Int√©gration Frontend

Le backend est configur√© pour accepter les requ√™tes du frontend React sur :
- http://localhost:5173 (Vite dev server)
- http://localhost:3000 (React dev server)

Pour ajouter d'autres origines, modifier `application.properties` :
```properties
cors.allowed-origins=http://localhost:5173,http://localhost:3000,http://autre-origine
```

## üìù Variables d'Environnement

Vous pouvez surcharger les propri√©t√©s via des variables d'environnement :

```bash
export JWT_SECRET=votre_secret_jwt
export JWT_EXPIRATION=86400000
export UPLOAD_DIR=/chemin/vers/uploads
```

## üêõ D√©bogage

Pour activer les logs d√©taill√©s :

```properties
logging.level.tn.enicarthage=DEBUG
logging.level.org.springframework.security=DEBUG
```

## üìÑ Licence

Ce projet est d√©velopp√© pour ENICarthage.

## üë®‚Äçüíª Support

Pour toute question ou probl√®me, veuillez contacter l'√©quipe de d√©veloppement.
#   E n i c a r S t a f f M a n a g e B a c k 
 
 